<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BootStrap Weather App</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
  </head>

  <body class="vh-100 d-flex justify-content-center align-items-center bg-dark">
    <div
      id="bgEffect"
      class="position-fixed top-0 start-0 w-100 h-100 z-n1"
    ></div>

    <div
      class="card shadow-lg rounded-4"
      style="width: 26rem"
      data-aos="zoom-in"
    >
      <div class="card-body text-center">
        <h3 class="card-title mb-3" data-aos="fade-down">
          <i class="bi bi-globe2"></i>Weather App
        </h3>

        <div class="input-group mb-3" data-aos="fade-up">
          <input
            type="text"
            id="txtCity"
            class="form-control"
            placeholder="Enter city name..."
          />
          <button class="btn btn-success" onclick=" getWeather()">
            <i class="bi bi-search"></i>
          </button>
        </div>

        <div id="error" data-aos="fade"></div>

        <div id="spinner" class="d-none my-3">
          <div class="spinner-border text-primary" role="status"></div>
          <div class="mt-2 fw-semibold">Fetching weather....</div>
        </div>

        <div id="result" class="collapse mt-4">
          <i
            id="icon"
            class="bi bi-cloud display-1 text-primary"
            data-aos="zoom-in"
          ></i>
          \
          <h4 id="city" class="fw-bold mt-2" data-aos="fade-up"></h4>
          <h1 id="temp" class="fw-bold" data-aos="fade-up"></h1>

          <span
            id="desc"
            class="badge bg-secondary px-3 py-2"
            data-aos="fade-up"
          ></span>
        </div>
      </div>
    </div>
    <script>
      AOS.init({
        duration: 900,
        once: true,
      });

      function setWeatherBackground(weather) {
        const bg = document.getElementById("bgEffect");
        bg.className =
          " position-fixed top-0 start-0 w-100 h-100 z-n1 bg-gradient";

        if (weather.includes("clear")) {
          bg.classList.add("bg-warning");
        } else if (weather.includes("cloud")) {
          bg.classList.add("bg-secondary");
        } else if (weather.includes("rain")) {
          bg.classList.add("bg-primary");
        } else if (weather.includes("snow")) {
          bg.classList.add("bg-info");
        } else {
          bg.classList.add("bg-dark");
        }
      }

      function getWeather() {
        let city = document.getElementById("txtCity").value;
        let error = document.getElementById("error");
        let spinner = document.getElementById("spinner");
        let result = document.getElementById("result");
        if (city === "") {
          error.innerHTML = `<div class=" alert alert-danger">Please enter a city name!</div>`;
          AOS.refresh();
          return;
        }
        error.innerHTML = "";
        result.classList.remove("show");
        spinner.classList.remove("d-none");

        let API_KEY = "44ee064efc88e95b3f0f38332b2177da";
        let API_URL = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${API_KEY}&units=metric`;

        fetch(API_URL)
          .then((response) => response.json())
          .then((data) => {
            spinner.classList.add("d-none");

            if (data.cod !== 200) {
              error.innerHTML = `<div class="alert alert-danger">City not found</div>`;
              return;
            }
            document.getElementById("city").textContent = data.name;
            document.getElementById("temp").innerHTML = `${Math.round(
              data.main.temp
            )}&deg;C`;
            document.getElementById("desc").textContent =
              data.weather[0].description.toUpperCase();

            let weather = data.weather[0].main.toLowerCase();
            setWeatherBackground(weather);

            let icon = "bi-cloud";
            if (weather.includes("clear")) icon = "bi-brightness-high-fill";
            else if (weather.includes("rain")) icon = "bi-cloud-rain-fill";
            else if (weather.includes("cloud")) icon = "bi-cloud-fill";
            else if (weather.includes("snow")) icon = "bi-snow";

            document.getElementById(
              "icon"
            ).className = `bi ${icon} display-1 text-primary`;

            new bootstrap.Collapse(result, { show: true });
            AOS.refresh();
          })
          .catch(() => {
            spinner.classList.add("d-none");
            error.innerHTML = `<div class="alert alert-warning">Error fetching data</div>`;
          });
      }
    </script>
  </body>
</html>
